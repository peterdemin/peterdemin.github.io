<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>How to set up a receiving email server on a Linux machine - Peter Demin</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Tell me a story about how you coached a team member" href="46-coaching.html" /><link rel="prev" title="Reaction to interview rejection emails" href="44-rejection-response.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=44020203" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=51f15f49" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="How to set up a receiving email server on a Linux machine"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>Peter Demin</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#context">Context</a></li>
<li><a class="reference internal" href="#configure-linux">Configure Linux</a></li>
<li><a class="reference internal" href="#open-ports-in-firewall-settings">Open ports in Firewall settings</a></li>
<li><a class="reference internal" href="#add-dns-record">Add DNS record</a></li>
<li><a class="reference internal" href="#check-emails">Check emails</a></li>
<li><a class="reference internal" href="#disable-the-mail-server-when-you-don-t-need-it">Disable the mail server when you don&#8217;t need it</a></li>
<li><a class="reference internal" href="#the-content">The content</a></li>
</ul>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div>
    </div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="w-full max-sm:max-w-full print:pt-6">
    
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Peter Demin</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">How to set up a receiving email server on a Linux machine</strong>
        <meta itemprop="position" content="2" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div>
    <div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <article class="yue" role="main">
          <section id="how-to-set-up-a-receiving-email-server-on-a-linux-machine">
<h1>How to set up a receiving email server on a Linux machine<a class="headerlink" href="#how-to-set-up-a-receiving-email-server-on-a-linux-machine" title="Link to this heading">¶</a></h1>
<section id="context">
<h2>Context<a class="headerlink" href="#context" title="Link to this heading">¶</a></h2>
<p>Most of the time, I’m happy with my Gmail.
It has nice clients, filters out spam okay, and integrates with Google Calendar.
But sometimes, companies will only give me their special content if I pass them my work email.
Whether this content is valuable or not is a separate question.
Here, I explain the technical solution to getting a mailbox on your custom domain.
(Assuming you already host a Linux server on your domain and have access to everything.)</p>
</section>
<section id="configure-linux">
<h2>Configure Linux<a class="headerlink" href="#configure-linux" title="Link to this heading">¶</a></h2>
<ol class="arabic">
<li><p>Install and configure postfix</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>postfix<span class="w"> </span>-y
</span></pre></div>
</div>
</li>
<li><p>Configure the hostname and destination in <code class="docutils literal notranslate"><span class="pre">/etc/postfix/main.cf</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1">myhostname = mail.demin.dev
</span><span data-line="2">mydestination = $myhostname localhost.$mydomain localhost $mydomain
</span></pre></div>
</div>
<p>(<code class="docutils literal notranslate"><span class="pre">mydomain</span></code> is autogenerated from <code class="docutils literal notranslate"><span class="pre">myhostname</span></code> by removing the first part)</p>
</li>
<li><p>If your username is not the same as the desired email, add an alias to <code class="docutils literal notranslate"><span class="pre">/etc/aliases</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">peter</span><span class="p">:</span>    <span class="n">peterdemin</span>
</span></pre></div>
</div>
<p>Make sure to update the postfix alias database with the new config:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">sudo<span class="w"> </span>newaliases
</span></pre></div>
</div>
</li>
<li><p>Set domain name in <code class="docutils literal notranslate"><span class="pre">/etc/mailname</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">demin</span><span class="o">.</span><span class="n">dev</span>
</span></pre></div>
</div>
</li>
<li><p>Start the server:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>postfix
</span></pre></div>
</div>
</li>
<li><p>Verify the mail daemon listens on port <code class="docutils literal notranslate"><span class="pre">25</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">$<span class="w"> </span>sudo<span class="w"> </span>lsof<span class="w"> </span>-Pni:25
</span><span data-line="2">COMMAND<span class="w">  </span>PID<span class="w"> </span>USER<span class="w">   </span>FD<span class="w">   </span>TYPE<span class="w"> </span>DEVICE<span class="w"> </span>SIZE/OFF<span class="w"> </span>NODE<span class="w"> </span>NAME
</span><span data-line="3">master<span class="w">  </span><span class="m">4116</span><span class="w"> </span>root<span class="w">   </span>13u<span class="w">  </span>IPv4<span class="w">  </span><span class="m">76561</span><span class="w">      </span>0t0<span class="w">  </span>TCP<span class="w"> </span>*:25<span class="w"> </span><span class="o">(</span>LISTEN<span class="o">)</span>
</span><span data-line="4">master<span class="w">  </span><span class="m">4116</span><span class="w"> </span>root<span class="w">   </span>14u<span class="w">  </span>IPv6<span class="w">  </span><span class="m">76562</span><span class="w">      </span>0t0<span class="w">  </span>TCP<span class="w"> </span>*:25<span class="w"> </span><span class="o">(</span>LISTEN<span class="o">)</span>
</span></pre></div>
</div>
</li>
</ol>
</section>
<section id="open-ports-in-firewall-settings">
<h2>Open ports in Firewall settings<a class="headerlink" href="#open-ports-in-firewall-settings" title="Link to this heading">¶</a></h2>
<ul class="simple">
<li><p>TCP port: <code class="docutils literal notranslate"><span class="pre">25</span></code></p></li>
<li><p>IP range: <code class="docutils literal notranslate"><span class="pre">0.0.0.0/0</span></code></p></li>
</ul>
<p>Email infrastructure uses other ports as well, but we don’t need them:
IMAP: <code class="docutils literal notranslate"><span class="pre">143</span></code>, <code class="docutils literal notranslate"><span class="pre">993</span></code>, SMTP for sending emails from this server: <code class="docutils literal notranslate"><span class="pre">465</span></code>, <code class="docutils literal notranslate"><span class="pre">587</span></code>.</p>
</section>
<section id="add-dns-record">
<h2>Add DNS record<a class="headerlink" href="#add-dns-record" title="Link to this heading">¶</a></h2>
<p>Consider you want to have an email address: <code class="docutils literal notranslate"><span class="pre">peter&#64;demin.dev</span></code>.
And the IP address of the machine running the mail agent is <code class="docutils literal notranslate"><span class="pre">35.237.50.91</span></code>.</p>
<ol class="arabic simple">
<li><p>MX record:</p>
<ul class="simple">
<li><p>Host name: demin.dev</p></li>
<li><p>Type: MX</p></li>
<li><p>TTL: 1 hour</p></li>
<li><p>Data: 10 mail.demin.dev.</p></li>
</ul>
</li>
<li><p>Mail server A record:</p>
<ul class="simple">
<li><p>Host name: mail.demin.dev</p></li>
<li><p>Type: A</p></li>
<li><p>TTL: 1 hour</p></li>
<li><p>Data: 35.237.50.91</p></li>
</ul>
</li>
</ol>
</section>
<section id="check-emails">
<h2>Check emails<a class="headerlink" href="#check-emails" title="Link to this heading">¶</a></h2>
<p>All incoming emails are appended to this file:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">less<span class="w"> </span>/var/spool/mail/<span class="si">${</span><span class="nv">USER</span><span class="si">}</span>
</span></pre></div>
</div>
<p>To have a better terminal experience reading incoming emails,
install and run <code class="docutils literal notranslate"><span class="pre">mutt</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>mutt<span class="w"> </span>w3m
</span></pre></div>
</div>
<p>Configure mutt to use w3m for rendering HTML in <code class="docutils literal notranslate"><span class="pre">~/.muttrc</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">auto_view</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span>
</span><span data-line="2"><span class="n">alternative_order</span> <span class="n">text</span><span class="o">/</span><span class="n">plain</span> <span class="n">text</span><span class="o">/</span><span class="n">html</span>
</span></pre></div>
</div>
<p>Sometimes inbound emails don’t have a plain-text representation,
and HTML comes in quoted-printable encoding so that long lines are broken
with extra equal signs prepended for continuation.
This makes it hard to click on links.</p>
<p>The w3m renderer hides the links altogether, so it’s not helpful either.
The solution is to save the email as a file and read it with <code class="docutils literal notranslate"><span class="pre">less</span></code>:</p>
<p>Inside mutt:</p>
<ul class="simple">
<li><p>press <code class="docutils literal notranslate"><span class="pre">v</span></code> to list attachments.</p></li>
<li><p>press Enter to open the HTML (usually it’s the first one).</p></li>
<li><p>press s and save the HTML as <code class="docutils literal notranslate"><span class="pre">mail.html</span></code>.</p></li>
<li><p>exit mutt (<code class="docutils literal notranslate"><span class="pre">q</span></code>).</p></li>
<li><p>view decoded file with <code class="docutils literal notranslate"><span class="pre">less</span> <span class="pre">mail.html</span></code>.</p></li>
</ul>
</section>
<section id="disable-the-mail-server-when-you-don-t-need-it">
<h2>Disable the mail server when you don’t need it<a class="headerlink" href="#disable-the-mail-server-when-you-don-t-need-it" title="Link to this heading">¶</a></h2>
<p>Just disable the firewall rule, and you can keep everything else intact.</p>
</section>
<section id="the-content">
<h2>The content<a class="headerlink" href="#the-content" title="Link to this heading">¶</a></h2>
<p>I don’t mean to pirate it, but since I had to go to such a great lengths to get them,
here are the books I downloaded using my custom domain email address:</p>
<ul class="simple">
<li><p><a class="reference download internal" download="" href="../_downloads/4b52dc3271e66e9aae1d3f4daf302a16/aws-eaas.pdf"><span class="xref download myst">Architecting event-driven API-first platforms to build Everything-as-a-Service</span></a></p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/6be2f56e8cf8120cb00252a99029e2ad/cockroachdb.pdf"><span class="xref download myst">CockroachDB The Definitive Guide</span></a></p></li>
<li><p><a class="reference download internal" download="" href="../_downloads/df4b0234fb4e3dd65b406a3853f4eaf7/survival.pdf"><span class="xref download myst">CockroachDB The Engineer’s Survival GUIDE</span></a></p></li>
</ul>
</section>
</section>

        </article>
        <button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button>
        <div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="44-rejection-response.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Reaction to interview rejection emails</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="46-coaching.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Tell me a story about how you coached a team member</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div>
        
      </div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2022, Peter Demin</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=cac61aee"></script></body>
</html>