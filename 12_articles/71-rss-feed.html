<!DOCTYPE html>
<html lang="en" data-accent-color="violet" data-content_root="../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>My RSS feed reader setup - Peter Demin</title><link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Book a 15-minute call with me" href="72-calendly.html" /><link rel="prev" title="Configuration-Driven Development" href="70-options-design.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"auto");
  </script><link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=e1a1ceaf" />
    <link rel="stylesheet" type="text/css" href="../_static/shibuya.css?v=44020203" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../_static/print.css?v=20ff2c19" />
    <link rel="stylesheet" type="text/css" href="../_static/custom.css?v=51f15f49" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/><meta property="og:title" content="My RSS feed reader setup"/>
    <meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../index.html">
      
      
      <strong>Peter Demin</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials"></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2"></span>
          <span class="hamburger_3"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><div class="localtoc"><h3>On this page</h3><ul>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#systemd-unit">SystemD Unit</a></li>
<li><a class="reference internal" href="#reverse-proxy">Reverse proxy</a></li>
<li><a class="reference internal" href="#user-registration">User registration</a></li>
<li><a class="reference internal" href="#backup">Backup</a></li>
<li><a class="reference internal" href="#the-treasure">The treasure</a></li>
<li><a class="reference internal" href="#hardened-systemd-unit">Hardened SystemD Unit</a></li>
<li><a class="reference internal" href="#opml-to-markdown-script">OPML to Markdown script</a></li>
<li><a class="reference internal" href="#building-from-source">Building from source</a></li>
</ul>
</div><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/peterdemin/peterdemin.github.io"
  data-type="github" data-user="peterdemin" data-repo="peterdemin.github.io">
  <span class="w-8 flex items-center justify-around shrink-0 text-3xl">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </span>
  <span class="flex-grow px-2 break-all">
    
    
      <span>peterdemin.github.io</span>
    
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <iconify-icon icon="lucide:star"></iconify-icon>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <iconify-icon icon="lucide:git-fork"></iconify-icon>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a><div class="edit-this-page">
  <a href="https://github.com/peterdemin/peterdemin.github.io/blob/master/source/12_articles/71-rss-feed.md">Edit this page</a>
</div><div id="ethical-ad-placement" data-ea-publisher="readthedocs"></div>
    </div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="w-full max-sm:max-w-full print:pt-6">
    
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../index.html"><span itemprop="name">Peter Demin</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">My RSS feed reader setup</strong>
        <meta itemprop="position" content="2" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div>
    <div class="flex flex-col break-words justify-between">
      <div class="relative min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
  <div class="copy-page-wrapper relative pb-4 lg:absolute lg:top-8 lg:right-6 xl:right-12">
  <div id="copy-page-trigger">
    <button
      type="button"
      class="js-copy px-3 py-1 inline-flex items-center gap-1"
      data-url="https://raw.githubusercontent.com/peterdemin/peterdemin.github.io/refs/heads/master/source/12_articles/71-rss-feed.md.txt"
    >
      <i class="i-lucide" data-icon="copy"></i>
      <span>Copy page</span>
    </button>
    <button class="js-menu px-2 py-1" type="button" aria-label="More actions"
      aria-haspopup="menu" aria-expanded="false" aria-controls="copy-page-content">
      <i class="i-lucide chevron-down"></i>
    </button>
  </div>
  <div id="copy-page-content" role="menu" aria-orientation="vertical" aria-hidden="true">
    <div role="presentation">
      <div class="flex flex-col" role="group">
        <button class="js-copy" type="button" role="menuitem"
          data-url="https://raw.githubusercontent.com/peterdemin/peterdemin.github.io/refs/heads/master/source/12_articles/71-rss-feed.md.txt">
          <span class="iconify-icon">
            <i class="i-lucide" data-icon="copy"></i>
          </span>
          <span>Copy page</span>
        </button>
        <a role="menuitem" href="https://raw.githubusercontent.com/peterdemin/peterdemin.github.io/refs/heads/master/source/12_articles/71-rss-feed.md.txt" target="_blank" rel="nofollow"><iconify-icon icon="bi:markdown"></iconify-icon>
            <span>View as Markdown</span></a><a role="menuitem" href="https://chatgpt.com/?hints=search&q=Read%20https%3A//raw.githubusercontent.com/peterdemin/peterdemin.github.io/refs/heads/master/source/12_articles/71-rss-feed.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:openai"></iconify-icon>
          <span>Open in ChatGPT</span>
        </a><a role="menuitem" href="https://claude.ai/new?q=Read%20https%3A//raw.githubusercontent.com/peterdemin/peterdemin.github.io/refs/heads/master/source/12_articles/71-rss-feed.md.txt%20so%20I%20can%20ask%20questions%20about%20it." target="_blank" rel="nofollow">
          <iconify-icon icon="bi:claude"></iconify-icon>
          <span>Open in Claude</span>
        </a></div>
    </div>
  </div>
</div><article class="yue" role="main">
          <section id="my-rss-feed-reader-setup">
<h1>My RSS feed reader setup<a class="headerlink" href="#my-rss-feed-reader-setup" title="Link to this heading">¶</a></h1>
<p>I run a <a class="reference external" href="https://github.com/Athou/commafeed">CommaFeed</a> instance on a free-tier Google Cloud Platform virtual machine.
It’s a Google Reader-inspired self-hosted personal RSS reader.</p>
<p>I’m not using Docker, in part because the VM has only 0.25 CPU and, in part, because I like simple things.</p>
<section id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Link to this heading">¶</a></h2>
<p>CommaFeed service runs under a SystemD Unit using a separate system user with a home directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="n">sudo</span> <span class="n">useradd</span> <span class="o">-</span><span class="n">rms</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/</span><span class="n">nologin</span> <span class="n">commafeed</span>
</span><span data-line="2"><span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">commafeed</span> <span class="n">wget</span> <span class="o">-</span><span class="n">O</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">commafeed</span><span class="o">/</span><span class="n">commafeed</span> \
</span><span data-line="3">    <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Athou</span><span class="o">/</span><span class="n">commafeed</span><span class="o">/</span><span class="n">releases</span><span class="o">/</span><span class="n">download</span><span class="o">/</span><span class="mf">5.12.1</span><span class="o">/</span><span class="n">commafeed</span><span class="o">-</span><span class="mf">5.12.1</span><span class="o">-</span><span class="n">h2</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="n">runner</span>
</span><span data-line="4"><span class="n">sudo</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">commafeed</span><span class="o">/</span><span class="n">commafeed</span>
</span></pre></div>
</div>
<p>(Check the <a class="reference external" href="https://github.com/Athou/commafeed/releases/latest">releases page</a> to get the latest native binary for your operating system).</p>
</section>
<section id="systemd-unit">
<h2>SystemD Unit<a class="headerlink" href="#systemd-unit" title="Link to this heading">¶</a></h2>
<p>Create a Systemd Unit:</p>
<p><code class="docutils literal notranslate"><span class="pre">/etc/systemd/system/commafeed.service</span></code>:</p>
<div class="highlight-systemd notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">[Unit]</span>
</span><span data-line="2"><span class="na">Description</span><span class="o">=</span><span class="s">A bloat-free feed reader</span>
</span><span data-line="3"><span class="na">After</span><span class="o">=</span><span class="s">local-fs.target network.target</span>
</span><span data-line="4">
</span><span data-line="5"><span class="k">[Service]</span>
</span><span data-line="6"><span class="na">User</span><span class="o">=</span><span class="s">commafeed</span>
</span><span data-line="7"><span class="na">Group</span><span class="o">=</span><span class="s">commafeed</span>
</span><span data-line="8"><span class="na">WorkingDirectory</span><span class="o">=</span><span class="s">/home/commafeed</span>
</span><span data-line="9"><span class="na">ExecStart</span><span class="o">=</span><span class="s">/home/commafeed/commafeed</span>
</span><span data-line="10"><span class="na">SyslogIdentifier</span><span class="o">=</span><span class="s">commafeed</span>
</span><span data-line="11"><span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
</span><span data-line="12">
</span><span data-line="13"><span class="k">[Install]</span>
</span><span data-line="14"><span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</span></pre></div>
</div>
<p>(Check out the hardened version below.)</p>
<p>To launch the Commafeed service, run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">sudo<span class="w"> </span>systemctl<span class="w"> </span>daemon-reload
</span><span data-line="2">sudo<span class="w"> </span>systemctl<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>commafeed.service
</span><span data-line="3">sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>commafeed.service
</span></pre></div>
</div>
</section>
<section id="reverse-proxy">
<h2>Reverse proxy<a class="headerlink" href="#reverse-proxy" title="Link to this heading">¶</a></h2>
<p>Nginx has a section dedicated to proxy pass <code class="docutils literal notranslate"><span class="pre">feed</span></code> subdomain to a localhost port:</p>
<p><code class="docutils literal notranslate"><span class="pre">/etc/nginx/sites-available/commafeed</span></code>:</p>
<div class="highlight-nginx notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">server</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="2"><span class="w">    </span><span class="kn">server_name</span><span class="w"> </span><span class="s">feed.demin.dev</span><span class="p">;</span>
</span><span data-line="3"><span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="4"><span class="w">      </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:8082</span><span class="p">;</span>
</span><span data-line="5"><span class="w">      </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">X-Forwarded-Proto</span><span class="w"> </span><span class="s">https</span><span class="p">;</span>
</span><span data-line="6"><span class="w">      </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Host</span><span class="w"> </span><span class="nv">$http_host</span><span class="p">;</span>
</span><span data-line="7"><span class="w">    </span><span class="p">}</span>
</span><span data-line="8"><span class="w">    </span><span class="kn">location</span><span class="w"> </span><span class="s">/ws</span><span class="w"> </span><span class="p">{</span>
</span><span data-line="9"><span class="w">      </span><span class="kn">proxy_pass</span><span class="w"> </span><span class="s">http://127.0.0.1:8082</span><span class="p">;</span>
</span><span data-line="10"><span class="w">      </span><span class="kn">proxy_http_version</span><span class="w"> </span><span class="mi">1</span><span class="s">.1</span><span class="p">;</span>
</span><span data-line="11"><span class="w">      </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Upgrade</span><span class="w"> </span><span class="nv">$http_upgrade</span><span class="p">;</span>
</span><span data-line="12"><span class="w">      </span><span class="kn">proxy_set_header</span><span class="w"> </span><span class="s">Connection</span><span class="w"> </span><span class="s">&quot;upgrade&quot;</span><span class="p">;</span>
</span><span data-line="13"><span class="w">      </span><span class="kn">proxy_read_timeout</span><span class="w"> </span><span class="s">1h</span><span class="p">;</span>
</span><span data-line="14"><span class="w">      </span><span class="kn">proxy_send_timeout</span><span class="w"> </span><span class="s">1h</span><span class="p">;</span>
</span><span data-line="15"><span class="w">    </span><span class="p">}</span>
</span><span data-line="16"><span class="p">}</span>
</span></pre></div>
</div>
<p>Configure TLS certificates (using certbot, for example).</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">ln<span class="w"> </span>-sf<span class="w"> </span>/etc/nginx/sites-available/commafeed<span class="w"> </span>/etc/nginx/sites-enabled/commafeed
</span></pre></div>
</div>
</section>
<section id="user-registration">
<h2>User registration<a class="headerlink" href="#user-registration" title="Link to this heading">¶</a></h2>
<p>CommaFeed comes with an <code class="docutils literal notranslate"><span class="pre">admin</span></code> account with password <code class="docutils literal notranslate"><span class="pre">admin</span></code>.</p>
<p>Once you have the service running, you’ve got to be quick to log in to it before any hackers do.
Open the CommaFeed Web UI in your browser (in my case, https://feed.demin.dev) and log in as <code class="docutils literal notranslate"><span class="pre">admin:admin</span></code>.
Open the Profile/User management, and create an account for yourself (and maybe delete the admin account for good).</p>
</section>
<section id="backup">
<h2>Backup<a class="headerlink" href="#backup" title="Link to this heading">¶</a></h2>
<p>I wouldn’t want to lose the extensive library of feeds I aggregated over many years.
My solution is to export the <a class="reference download internal" download="" href="../_downloads/bcbdf9250536e27c58b0e254c61af7b7/71-opml.xml"><span class="xref download myst">OPML file</span></a> whenever I think about how I don’t want to lose it.
That’s a standard format that is easy to inspect and migrate to another service.</p>
<p>CommaFeed provides a REST API for the export.
You’ll need to generate an API key to use it.
It’s available on the profile page.</p>
<p>Export your OPML file via the <a class="reference external" href="https://www.commafeed.com/api-documentation/#/Feeds/get_rest_feed_export">REST API</a>
(append <code class="docutils literal notranslate"><span class="pre">?apiKey=&lt;your</span> <span class="pre">key&gt;</span></code> at the end of the URL).</p>
<p>Here’s how I do it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1">curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;https://feed.demin.dev/rest/feed/export?apiKey=</span><span class="nv">$COMMAFEED_API_KEY</span><span class="s2">&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span data-line="2"><span class="w">    </span><span class="p">|</span><span class="w"> </span>tee<span class="w"> </span>source/12_articles/71-opml.xml<span class="w"> </span><span class="se">\</span>
</span><span data-line="3"><span class="w">    </span><span class="p">|</span><span class="w"> </span>python<span class="w"> </span>opml2md.py<span class="w"> </span><span class="se">\</span>
</span><span data-line="4"><span class="w">    </span>&gt;<span class="w"> </span>source/12_articles/71-subscriptions.mdpart
</span></pre></div>
</div>
</section>
<section id="the-treasure">
<h2>The treasure<a class="headerlink" href="#the-treasure" title="Link to this heading">¶</a></h2>
<p>Here’s the list of feeds from the OPML file in alphabetical order:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://adamj.eu/tech/atom.xml">Adam Johnson</a></p></li>
<li><p><a class="reference external" href="https://nesbitt.io/feed.xml">Andrew Nesbitt</a></p></li>
<li><p><a class="reference external" href="https://lucumr.pocoo.org/feed.atom">Armin Ronacher’s Thoughts and Writings</a></p></li>
<li><p><a class="reference external" href="https://johnthenerd.com/blog/index.xml">Blogs on John’s Website</a></p></li>
<li><p><a class="reference external" href="https://chriskiehl.com/rss.xml">chriskiehl.com</a></p></li>
<li><p><a class="reference external" href="https://codahale.com/atom.xml">codahale.com</a></p></li>
<li><p><a class="reference external" href="https://alinpanaitiu.com/index.xml">Copper • A blog about conductive layers</a></p></li>
<li><p><a class="reference external" href="https://danluu.com/atom.xml">Dan Luu</a></p></li>
<li><p><a class="reference external" href="https://mcfunley.com/feed.xml">Dan McKinley</a></p></li>
<li><p><a class="reference external" href="https://blog.dbsmasher.com/feed.xml">dbsmasher corner</a></p></li>
<li><p><a class="reference external" href="https://hynek.me/index.xml">Hynek Schlawack</a></p></li>
<li><p><a class="reference external" href="https://lethain.com/feeds.xml">Irrational Exuberance</a></p></li>
<li><p><a class="reference external" href="https://cep.dev/posts/index.xml">Jack</a></p></li>
<li><p><a class="reference external" href="https://www.rubick.com/rss.xml">Jade Rubick</a></p></li>
<li><p><a class="reference external" href="https://jamieadams.click/index.xml">Jamie Adams</a></p></li>
<li><p><a class="reference external" href="https://sohl-dickstein.github.io/feed.xml">Jascha’s blog</a></p></li>
<li><p><a class="reference external" href="https://journal.stuffwithstuff.com/rss.xml">journal.stuffwithstuff.com</a></p></li>
<li><p><a class="reference external" href="https://kevincox.ca/feed.atom">Kevin Cox’s Blog</a></p></li>
<li><p><a class="reference external" href="https://kk.org/feed">Kevin Kelly</a></p></li>
<li><p><a class="reference external" href="https://kobzol.github.io/feed.xml">Kobzol’s blog</a></p></li>
<li><p><a class="reference external" href="https://uvdn7.github.io/feed.xml">Lu’s blog</a></p></li>
<li><p><a class="reference external" href="https://martinfowler.com/feed.atom">Martin Fowler</a></p></li>
<li><p><a class="reference external" href="https://matt-rickard.com/rss">Matt Rickard</a></p></li>
<li><p><a class="reference external" href="https://maurycyz.com/index.xml">Maurycy’s blog</a></p></li>
<li><p><a class="reference external" href="https://max.engineer/feed.rss">Max Chernyak</a></p></li>
<li><p><a class="reference external" href="https://mertbulan.com/feed.xml">Mert Bulan</a></p></li>
<li><p><a class="reference external" href="https://www.morling.dev/blog/index.xml">morling.dev – Blog</a></p></li>
<li><p><a class="reference external" href="https://blog.davidv.dev/rss.xml">Mumbling about computers</a></p></li>
<li><p><a class="reference external" href="https://nathan.rs/posts/index.xml">Nathan Barry</a></p></li>
<li><p><a class="reference external" href="https://nicolaiarocci.com/index.xml">Nicola Iarocci</a></p></li>
<li><p><a class="reference external" href="https://joshs.bearblog.dev/feed/">people, ideas, machines</a></p></li>
<li><p><a class="reference external" href="https://peter.demin.dev/life.xml?x=1">Peter Demin</a></p></li>
<li><p><a class="reference external" href="https://phiresky.github.io/blog/rss">phiresky’s blog</a></p></li>
<li><p><a class="reference external" href="https://minimaxir.com/post/index.xml">Posts on Max Woolf’s Blog</a></p></li>
<li><p><a class="reference external" href="https://laplab.me/posts/index.xml">Posts on Nikita Lapkov</a></p></li>
<li><p><a class="reference external" href="https://functional.computer/feed.xml">samir : coffee → nonsense</a></p></li>
<li><p><a class="reference external" href="https://www.seangoedecke.com/rss.xml">seangoedecke.com RSS feed</a></p></li>
<li><p><a class="reference external" href="https://scottaaronson.blog/?feed=rss2">Shtetl-Optimized</a></p></li>
<li><p><a class="reference external" href="https://sobolevn.me/feed.xml">sobolevn’s personal blog</a></p></li>
<li><p><a class="reference external" href="https://specbranch.com/index.xml">Speculative Branches</a></p></li>
<li><p><a class="reference external" href="http://blog.cleancoder.com/atom.xml">The Clean Code Blog</a></p></li>
<li><p><a class="reference external" href="https://feedpress.me/TheTechnium">The Technium (Kevin Kelly)</a></p></li>
<li><p><a class="reference external" href="https://jyn.dev/atom.xml">the website of jyn</a></p></li>
<li><p><a class="reference external" href="https://thesephist.com/index.xml">thesephist</a></p></li>
<li><p><a class="reference external" href="https://hynek.me/til/index.xml">Today Hynek Learned on Hynek Schlawack</a></p></li>
<li><p><a class="reference external" href="https://tonsky.me/atom.xml">tonsky.me</a></p></li>
<li><p><a class="reference external" href="https://trekhleb.dev/rss.xml">Trekhleb.dev RSS Feed</a></p></li>
<li><p><a class="reference external" href="https://entropicthoughts.com/feed">Two-Wrongs</a></p></li>
<li><p><a class="reference external" href="https://www.uninformativ.de/blog/feeds/en.atom">uninformativ.de (en)</a></p></li>
<li><p><a class="reference external" href="https://vsupalov.com/index.xml">Vladislav Supalov</a></p></li>
<li><p><a class="reference external" href="https://wilw.dev/rss.xml">Will Webberley’s Blog</a></p></li>
<li><p><a class="reference external" href="https://christine.website/blog.rss">Xe’s Blog</a></p></li>
<li><p><a class="reference external" href="https://www.yegor256.com/rss.xml">Yegor Bugayenko</a></p></li>
<li><p><a class="reference external" href="https://xn--gckvb8fzb.com/index.xml">マリウス</a></p></li>
</ul>
</section>
<section id="hardened-systemd-unit">
<h2>Hardened SystemD Unit<a class="headerlink" href="#hardened-systemd-unit" title="Link to this heading">¶</a></h2>
<p>As a usual best practice, we should apply the principle of least privilege.
The hardened version, which won’t let CommaFeed process do any harm even if it gets hacked:</p>
<div class="highlight-systemd notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="k">[Unit]</span>
</span><span data-line="2"><span class="na">Description</span><span class="o">=</span><span class="s">A bloat-free feed reader</span>
</span><span data-line="3"><span class="na">Wants</span><span class="o">=</span><span class="s">network-online.target</span>
</span><span data-line="4"><span class="na">After</span><span class="o">=</span><span class="s">local-fs.target network-online.target</span>
</span><span data-line="5">
</span><span data-line="6"><span class="k">[Service]</span>
</span><span data-line="7"><span class="na">Type</span><span class="o">=</span><span class="s">simple</span>
</span><span data-line="8"><span class="na">User</span><span class="o">=</span><span class="s">commafeed</span>
</span><span data-line="9"><span class="na">Group</span><span class="o">=</span><span class="s">commafeed</span>
</span><span data-line="10"><span class="na">WorkingDirectory</span><span class="o">=</span><span class="s">/home/commafeed</span>
</span><span data-line="11"><span class="na">ExecStart</span><span class="o">=</span><span class="s">/home/commafeed/commafeed</span>
</span><span data-line="12"><span class="na">SyslogIdentifier</span><span class="o">=</span><span class="s">commafeed</span>
</span><span data-line="13"><span class="na">Restart</span><span class="o">=</span><span class="s">always</span>
</span><span data-line="14"><span class="na">RestartSec</span><span class="o">=</span><span class="s">2</span>
</span><span data-line="15"><span class="na">Environment</span><span class="o">=</span><span class="s">&quot;COMMAFEED_HTTP_CLIENT_MAX_RESPONSE_SIZE=10M&quot;</span>
</span><span data-line="16">
</span><span data-line="17"><span class="c1"># Baseline safety</span>
</span><span data-line="18"><span class="na">NoNewPrivileges</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="19"><span class="na">UMask</span><span class="o">=</span><span class="s">0077</span>
</span><span data-line="20"><span class="na">RemoveIPC</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="21"><span class="na">CapabilityBoundingSet</span><span class="o">=</span>
</span><span data-line="22"><span class="na">AmbientCapabilities</span><span class="o">=</span>
</span><span data-line="23">
</span><span data-line="24"><span class="c1"># Filesystem sandbox</span>
</span><span data-line="25"><span class="na">ProtectSystem</span><span class="o">=</span><span class="s">strict</span>
</span><span data-line="26"><span class="na">ProtectHome</span><span class="o">=</span><span class="s">read-only</span>
</span><span data-line="27"><span class="na">ReadWritePaths</span><span class="o">=</span><span class="s">/home/commafeed/data</span>
</span><span data-line="28">
</span><span data-line="29"><span class="c1"># Stop it from seeing other processes&#39; details</span>
</span><span data-line="30"><span class="na">ProtectProc</span><span class="o">=</span><span class="s">invisible</span>
</span><span data-line="31"><span class="na">ProcSubset</span><span class="o">=</span><span class="s">pid</span>
</span><span data-line="32">
</span><span data-line="33"><span class="c1"># Kernel / namespace / device isolation</span>
</span><span data-line="34"><span class="na">PrivateTmp</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="35"><span class="na">PrivateDevices</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="36"><span class="na">PrivateUsers</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="37"><span class="na">PrivateMounts</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="38">
</span><span data-line="39"><span class="na">ProtectControlGroups</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="40"><span class="na">ProtectKernelTunables</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="41"><span class="na">ProtectKernelModules</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="42"><span class="na">ProtectKernelLogs</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="43"><span class="na">ProtectClock</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="44"><span class="na">ProtectHostname</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="45">
</span><span data-line="46"><span class="na">LockPersonality</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="47"><span class="na">RestrictSUIDSGID</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="48"><span class="na">RestrictRealtime</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="49"><span class="na">RestrictNamespaces</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="50"><span class="na">MemoryDenyWriteExecute</span><span class="o">=</span><span class="s">yes</span>
</span><span data-line="51">
</span><span data-line="52"><span class="c1"># Syscall filtering</span>
</span><span data-line="53"><span class="na">SystemCallArchitectures</span><span class="o">=</span><span class="s">native</span>
</span><span data-line="54"><span class="na">SystemCallFilter</span><span class="o">=</span><span class="s">@system-service @network-io</span>
</span><span data-line="55"><span class="na">SystemCallErrorNumber</span><span class="o">=</span><span class="s">EPERM</span>
</span><span data-line="56">
</span><span data-line="57"><span class="c1"># Only allow the socket families it likely needs</span>
</span><span data-line="58"><span class="na">RestrictAddressFamilies</span><span class="o">=</span><span class="s">AF_UNIX AF_INET AF_INET6</span>
</span><span data-line="59">
</span><span data-line="60"><span class="c1"># Optional resource limits</span>
</span><span data-line="61"><span class="na">LimitNOFILE</span><span class="o">=</span><span class="s">4096</span>
</span><span data-line="62">
</span><span data-line="63"><span class="k">[Install]</span>
</span><span data-line="64"><span class="na">WantedBy</span><span class="o">=</span><span class="s">multi-user.target</span>
</span></pre></div>
</div>
</section>
<section id="opml-to-markdown-script">
<h2>OPML to Markdown script<a class="headerlink" href="#opml-to-markdown-script" title="Link to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">opml2md.py</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="ch">#!/usr/bin/env python3</span>
</span><span data-line="2">
</span><span data-line="3"><span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
</span><span data-line="4"><span class="kn">import</span><span class="w"> </span><span class="nn">xml.etree.ElementTree</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ET</span>
</span><span data-line="5">
</span><span data-line="6">
</span><span data-line="7"><span class="k">def</span><span class="w"> </span><span class="nf">iter_outlines_with_xmlurl</span><span class="p">(</span><span class="n">root</span><span class="p">:</span> <span class="n">ET</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
</span><span data-line="8">    <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">root</span><span class="o">.</span><span class="n">iter</span><span class="p">(</span><span class="s2">&quot;outline&quot;</span><span class="p">):</span>
</span><span data-line="9">        <span class="n">xml_url</span> <span class="o">=</span> <span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;xmlUrl&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span data-line="10">        <span class="k">if</span> <span class="ow">not</span> <span class="n">xml_url</span><span class="p">:</span>
</span><span data-line="11">            <span class="k">continue</span>
</span><span data-line="12">        <span class="n">title</span> <span class="o">=</span> <span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;title&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">el</span><span class="o">.</span><span class="n">attrib</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span data-line="13">        <span class="k">if</span> <span class="ow">not</span> <span class="n">title</span><span class="p">:</span>
</span><span data-line="14">            <span class="n">title</span> <span class="o">=</span> <span class="n">xml_url</span>
</span><span data-line="15">        <span class="k">yield</span> <span class="n">title</span><span class="p">,</span> <span class="n">xml_url</span>
</span><span data-line="16">
</span><span data-line="17">
</span><span data-line="18"><span class="k">def</span><span class="w"> </span><span class="nf">opml_to_markdown</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
</span><span data-line="19">    <span class="k">return</span> <span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
</span><span data-line="20">        <span class="sa">f</span><span class="s2">&quot;- [</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">](</span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span data-line="21">        <span class="k">for</span> <span class="n">title</span><span class="p">,</span> <span class="n">url</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span data-line="22">            <span class="n">iter_outlines_with_xmlurl</span><span class="p">(</span><span class="n">ET</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">fin</span><span class="p">)</span><span class="o">.</span><span class="n">getroot</span><span class="p">()),</span>
</span><span data-line="23">            <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">casefold</span><span class="p">(),</span>
</span><span data-line="24">        <span class="p">)</span>
</span><span data-line="25">    <span class="p">)</span>
</span><span data-line="26">
</span><span data-line="27">
</span><span data-line="28"><span class="k">def</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="29">    <span class="nb">print</span><span class="p">(</span><span class="n">opml_to_markdown</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">))</span>
</span><span data-line="30">
</span><span data-line="31">
</span><span data-line="32"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
</span><span data-line="33">    <span class="n">main</span><span class="p">()</span>
</span></pre></div>
</div>
</section>
<section id="building-from-source">
<h2>Building from source<a class="headerlink" href="#building-from-source" title="Link to this heading">¶</a></h2>
<p>The 6.0.0 version had a bug that broke scrolling posts on Safari, the author fixed the issue promptly but wasn’t eager to publish a new release.
I figured I can use keyboard to scroll up and down until one day that stopped working as well.
So then I thought, let’s see if the new version fixes the issue.
I didn’t want to bother Jérémie with the release, so I decided to build it myself.</p>
<p>I’ve never built standalone Java programs (or used maven for that matter) and the README was a bit shallow on how to build it from source, so I vibed a builder script, that runs in a VM with Vagrant.</p>
<p><code class="docutils literal notranslate"><span class="pre">Vagrantfile</span></code>:</p>
<div class="highlight-ruby notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="c1"># -*- mode: ruby -*-</span>
</span><span data-line="2"><span class="c1"># vi: set ft=ruby :</span>
</span><span data-line="3">
</span><span data-line="4"><span class="no">Vagrant</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="s2">&quot;2&quot;</span><span class="p">)</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">config</span><span class="o">|</span>
</span><span data-line="5"><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">box</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;debian/trixie64&quot;</span>
</span><span data-line="6"><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">network</span><span class="w"> </span><span class="s2">&quot;private_network&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">ip</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;192.168.56.57&quot;</span>
</span><span data-line="7"><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">synced_folder</span><span class="w"> </span><span class="s2">&quot;./&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;/vagrant&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">type</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;virtiofs&quot;</span>
</span><span data-line="8"><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provider</span><span class="w"> </span><span class="ss">:libvirt</span><span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="o">|</span><span class="n">libvirt</span><span class="o">|</span>
</span><span data-line="9"><span class="w">      </span><span class="n">libvirt</span><span class="o">.</span><span class="n">driver</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;kvm&quot;</span>
</span><span data-line="10"><span class="w">      </span><span class="n">libvirt</span><span class="o">.</span><span class="n">uri</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;qemu:///system&#39;</span>
</span><span data-line="11"><span class="w">      </span><span class="n">libvirt</span><span class="o">.</span><span class="n">cpus</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">4</span>
</span><span data-line="12"><span class="w">      </span><span class="n">libvirt</span><span class="o">.</span><span class="n">memory</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;16384&quot;</span>
</span><span data-line="13"><span class="w">      </span><span class="n">libvirt</span><span class="o">.</span><span class="n">memorybacking</span><span class="w"> </span><span class="ss">:access</span><span class="p">,</span><span class="w"> </span><span class="ss">:mode</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="s2">&quot;shared&quot;</span>
</span><span data-line="14"><span class="w">    </span><span class="k">end</span>
</span><span data-line="15"><span class="w">    </span><span class="n">config</span><span class="o">.</span><span class="n">vm</span><span class="o">.</span><span class="n">provision</span><span class="w"> </span><span class="s2">&quot;shell&quot;</span><span class="p">,</span><span class="w"> </span><span class="ss">path</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;build.sh&quot;</span>
</span><span data-line="16"><span class="k">end</span>
</span></pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">build.sh</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span data-line="1"><span class="ch">#!/bin/bash</span>
</span><span data-line="2">
</span><span data-line="3"><span class="nb">set</span><span class="w"> </span>-eo<span class="w"> </span>pipefail
</span><span data-line="4">
</span><span data-line="5">sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</span><span data-line="6">sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>git<span class="w"> </span>maven<span class="w"> </span>build-essential<span class="w"> </span>zlib1g-dev<span class="w"> </span>curl<span class="w"> </span>zip<span class="w"> </span>unzip
</span><span data-line="7">curl<span class="w"> </span>-s<span class="w"> </span><span class="s2">&quot;https://get.sdkman.io&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span><span data-line="8"><span class="nb">source</span><span class="w"> </span><span class="s2">&quot;/root/.sdkman/bin/sdkman-init.sh&quot;</span>
</span><span data-line="9">sdk<span class="w"> </span>install<span class="w"> </span>java<span class="w"> </span><span class="m">25</span>-graal
</span><span data-line="10">sdk<span class="w"> </span>use<span class="w"> </span>java<span class="w"> </span><span class="m">25</span>-graal
</span><span data-line="11"><span class="nb">test</span><span class="w"> </span>-d<span class="w"> </span>commafeed<span class="w"> </span><span class="o">||</span><span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/Athou/commafeed.git
</span><span data-line="12"><span class="nb">cd</span><span class="w"> </span>commafeed
</span><span data-line="13"><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_OPTIONS</span><span class="o">=</span><span class="s2">&quot;--max-old-space-size=6144&quot;</span>
</span><span data-line="14">mvn<span class="w"> </span>-DskipTests<span class="w"> </span>-Pnative<span class="w"> </span>-Ph2<span class="w"> </span>clean<span class="w"> </span>package<span class="w"> </span>-Dquarkus.native.native-image-xmx<span class="o">=</span>14g
</span><span data-line="15">sudo<span class="w"> </span>cp<span class="w"> </span>commafeed-server/target/commafeed-*-h2-linux-x86_64-runner<span class="w"> </span>/vagrant/commafeed
</span></pre></div>
</div>
<p>Note the setting of 6 GB RAM for NodeJS and 14 GB for Java.
I kept doubling it until it stopped running out of memory.</p>
<p>The resulting binary is 163 MB, same as in the official release.</p>
<p>For what it worth, I deployed it and reloaded the page, but <a class="reference external" href="https://github.com/Athou/commafeed/issues/2030">the bug is still there</a>.
Whoops… But at least I’m running my own build now.
And it works in Firefox just fine.</p>
</section>
</section>

        </article>
        <button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button>
        <div class="navigation flex print:hidden"><div class="navigation-prev">
    <a href="70-options-design.html">
      <i class="i-lucide chevron-left"></i>
      <div class="page-info">
        <span>Previous</span><div class="title">Configuration-Driven Development</div></div>
    </a>
  </div><div class="navigation-next">
    <a href="72-calendly.html">
      <div class="page-info">
        <span>Next</span>
        <div class="title">Book a 15-minute call with me</div>
      </div>
      <i class="i-lucide chevron-right"></i>
    </a>
  </div></div>
        
      </div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2022, Peter Demin</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials"></div>
    </div>
  </div>
</footer>
      <script src="../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../_static/doctools.js?v=fd6eb6e6"></script>
      <script src="../_static/sphinx_highlight.js?v=6ffebe34"></script>
      <script src="../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../_static/shibuya.js?v=cac61aee"></script></body>
</html>